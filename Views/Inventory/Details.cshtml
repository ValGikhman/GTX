<script src="~/Scripts/Lightbox/lc_lightbox.lite.min.js" type="text/javascript"></script>
<link href="~/Content/Lightbox/lc_lightbox.min.css" rel="stylesheet" />

<!-- SKINS -->
<link href="~/Content/Lightbox/dark.css" rel="stylesheet" />

<!-- ASSETS -->
<script src="~/Scripts/AlloyFinger/alloy_finger.min.js" type="text/javascript"></script>

@{
    @model GTX.Models.BaseModel
    Html.RenderPartial("_PageTitle");
}

<div class="d-flex justify-content-center">
    <div class="p-3 w-45">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-item active btn btn-outline-secondary text-shadow-small" id="nav-details-tab" data-bs-toggle="tab" data-bs-target="#nav-details" type="button" role="tab" aria-controls="nav-details" aria-selected="true">Details</button>
                @{
                    if (Model.CurrentVehicle.VehicleImages.Count() > 0) {
                        <button class="nav-item btn btn-outline-secondary text-shadow-small" id="nav-pictures-tab" data-bs-toggle="tab" data-bs-target="#nav-pictures" type="button" role="tab" aria-controls="nav-pictures" aria-selected="false">Gallery ( @Model.CurrentVehicle.VehicleImages.Count())</button>
                    }
                }
                <button class="nav-item btn btn-outline-secondary text-shadow-small" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="true">Contact</button>
                <button class="nav-item btn btn-outline-secondary text-shadow-small" id="nav-location-tab" data-bs-toggle="tab" data-bs-target="#nav-location" type="button" role="tab" aria-controls="nav-location" aria-selected="true">Location</button>
                <button class="nav-item btn btn-outline-secondary text-shadow-small" id="nav-payment-tab" data-bs-toggle="tab" data-bs-target="#nav-payment" type="button" role="tab" aria-controls="nav-payment" aria-selected="true">Pay $<span id="monthlyAmount"></span>/monthly</button>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-details" role="tabpanel" aria-labelledby="nav-details-tab">
                <div class="row justify-content-center well">
                    @{
                        if (Model.CurrentVehicle.VehicleImages.Count() > 0) {
                            <div class="p-3 w-100">
                                @Html.Partial("_Carousel", Model.CurrentVehicle)
                            </div>
                        }
                        else {
                            <h6 class="text-uppercase p-4"><strong>No image yet</strong></h6>
                            <img class="d-block mx-auto bg-transparent" src="/GTXImages/Inventory/no-image.png" />
                        }
                    }
                </div>
            </div>
            <div class="tab-pane fade well" id="nav-pictures" role="tabpanel" aria-labelledby="nav-picture-tab">
                <div class="d-flex flex-wrap justify-content-center overflow-auto">
                    @foreach (string imageUrl in Model.CurrentVehicle.VehicleImages) {
                        <a class="elem three-d w-30" href="@imageUrl" data-lcl-thumb="@imageUrl">
                            <span class="shadow rounded" style="background-image: url(..@imageUrl);"></span>
                        </a>
                    }
                </div>
            </div>
            <div class="tab-pane fade well" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                <div id="contactTab" class="mx-auto w-75 mt-4">
                </div>
            </div>
            <div class="tab-pane fade well" id="nav-location" role="tabpanel" aria-labelledby="nav-location-tab">
                <div class="d-flex justify-content-evenly mt-4">
                    @{
                        GTX.Models.OpenHours[] openHours = Utility.XMLHelpers.XmlRepository.GetOpenHours();
                        if (openHours != null) {
                            foreach (var open in openHours) {
                                <span class="btn btn-outline-secondary shadow position-relative details">
                                    <span class="medium-small-text">@open.Description</span>
                                    <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                                        @open.Day
                                    </span>
                                </span>
                            }
                        }
                    }
                </div>
                <iframe loading="eager"
                        allowfullscreen
                        referrerpolicy="no-referrer-when-downgrade"
                        src="https://www.google.com/maps?q=9516+Prinston+Glendale+Rd,+West+Checter,+OH, 45011&output=embed"
                        class="well shadow my-3"
                        width="100%"
                        height="360">
                </iframe>
            </div>
            <div class="tab-pane fade well" id="nav-payment" role="tabpanel" aria-labelledby="nav-payment-tab">
                <div class="text-shadow-small rounded shadow" id="calculator">
                    <div class="text-center border-bottom p-3 my-auto">
                        <h6 class="text-uppercase fw-bold">@Model.CurrentVehicle.VehicleDetails.Year @Model.CurrentVehicle.VehicleDetails.Make @Model.CurrentVehicle.VehicleDetails.Model @Model.CurrentVehicle.VehicleDetails.VehicleType @Model.CurrentVehicle.VehicleDetails.VehicleStyle</h6>
                        <small class="text-shadow">Est. payment for <span id="monthTerms"></span> months at <span id="apr"></span>% APR</small>
                    </div>
                    <div class="row my-3">
                        <div class="col-md-4 col-6">
                            <div class="mb-3 mb-md-4">
                                <label class="text-shadow">Amount down</label>
                                <input id="downPayment" class="form-control" placeholder="10,000" max="1000000" required="" type="text" value="@(Math.Round(Math.Ceiling(Model.CurrentVehicle.VehicleDetails.RetailPrice * 0.2 / 500) * 500))">
                            </div>
                        </div>
                        <div class="col-md-4 col-6">
                            <div class="mb-3 mb-md-4">
                                <label class="text-shadow">Loan months</label>
                                <select id="month" name="term" class="form-control" onchange="calculate()">
                                    <option value="">Select...</option>
                                    <option value="36">36 months</option>
                                    <option value="48">48 months</option>
                                    <option value="60">60 months</option>
                                    <option value="72">72 months</option>
                                    <option value="75">75 months</option>
                                    <option value="84" selected>84 months</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 col-6">
                            <div class="mb-3 mb-md-4">
                                <label class="text-shadow">Zip</label>
                                <input id="zipCode" class="form-control" maxlength="5" minlength="5" type="text" value="">
                            </div>
                        </div>
                    </div>
                    <div class="py-3 border-top">
                        <label class="d-flex mb-2 justify-content-center text-shadow fw-bold">Credit score</label>
                        <div class="d-flex justify-content-evenly">
                            <input type="radio" class="btn-check" name="scores" id="scoreRebuilding" value="640" autocomplete="off">
                            <label class="btn btn-light border- shadow" for="scoreRebuilding">
                                Under 640
                                <span class="font-weight-bold d-none d-md-block medium-small-text">Rebuilding</span>
                            </label>

                            <input type="radio" class="btn-check" name="scores" id="scoreFair" value="699" autocomplete="off">
                            <label class="btn btn-light shadow" for="scoreFair">
                                640 - 699
                                <span class="font-weight-bold d-none d-md-block medium-small-text">Fair</span>
                            </label>

                            <input type="radio" class="btn-check" name="scores" id="scoreVeryGood" value="749" autocomplete="off">
                            <label class="btn btn-light shadow" for="scoreVeryGood">
                                700 - 749
                                <span class="font-weight-bold d-none d-md-block medium-small-text">Very Good</span>
                            </label>

                            <input type="radio" class="btn-check" name="scores" id="scoreExcellent" value="750" autocomplete="off" checked>
                            <label class="btn btn-light shadow" for="scoreExcellent">
                                Over 750
                                <span class="font-weight-bold d-none d-md-block medium-small-text">Excellent</span>
                            </label>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center">
                        <button type="submit" class="btn btn-secondary shadow my-3 shadow" onclick="calculate();">Calculate</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="p-4 w-35">
        @*Details*@
        <div class="row justify-content-center well shadow  my-3">
            <button class="btn btn-light shadow w-100" type="button" data-bs-toggle="collapse" data-bs-target="#details" aria-expanded="false" aria-controls="details">
                <div class="bg-lighter py-2 px-3 text-center hand-pointer">
                    <h5 class="fw-bold text-uppercase">Details</h5>
                </div>
            </button>
            <div class="collapse show text-shadow-small rounded p-2" id="details">
                <div class="d-flex justify-content-between mb-3 gap-4 flex-wrap">
                    <span class="very-small-text text-shadow-small">@Model.CurrentVehicle.VehicleDetails.VIN</span>
                    <span class="very-small-text text-shadow-small">@Model.CurrentVehicle.VehicleDetails.Stock</span>
                </div>
                <div class="d-flex justify-content-around gap-4 flex-wrap mb-3">
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.RetailPrice.ToString("C0")</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Price
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.Mileage.ToString("N0")</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Miles
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.Engine</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Engine
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.Body</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Body
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.VehicleType</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Type
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.Cylinders</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Cylinders
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.DriveTrain</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Drivetrain
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.Transmission/@Model.CurrentVehicle.VehicleDetails.TransmissionSpeed</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Transmission
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details">
                        <span class="medium-small-text">@Model.CurrentVehicle.VehicleDetails.FuelType</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            Fuel
                        </span>
                    </span>
                    <span class="btn btn-outline-secondary shadow position-relative details" style="background-color: @Model.CurrentVehicle.VehicleDetails.Color">
                        <span class="medium-small-text">&emsp;</span>
                        <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                            @Model.CurrentVehicle.VehicleDetails.Color
                        </span>
                    </span>
                    @{
                        if (!@Model.CurrentVehicle.VehicleDetails.Color2.IsEmpty()) {
                            <span class="btn btn-outline-secondary shadow position-relative details" style="background-color: @Model.CurrentVehicle.VehicleDetails.Color2">
                                <span class="medium-small-text">&emsp;</span>
                                <span class="position-absolute start-50 translate-middle shadow badge rounded bg-secondary">
                                    @Model.CurrentVehicle.VehicleDetails.Color2
                                </span>
                            </span>
                        }
                    }
                </div>
                <div class="d-flex justify-content-center my-4">
                    <a href="https://www.carfax.com/VehicleHistory/p/Report.cfx?vin=@Model.CurrentVehicle.VehicleDetails.VIN" target="_blank">
                        <img src="https://static.carfax.com/global-header/imgs/logo.svg" alt="Carfax Vehicle History Report">
                    </a>
                </div>
            </div>
        </div>

        @*Features*@
        <div class="row justify-content-center well my-3">
            <button class="btn btn-light shadow w-100" type="button" data-bs-toggle="collapse" data-bs-target="#features" aria-expanded="false" aria-controls="features">
                <div class="bg-lighter py-2 px-3 text-center hand-pointer">
                    <h5 class="fw-bold text-uppercase">Features</h5>
                </div>
            </button>
            <div class="collapse text-shadow-small rounded shadow mt-2" id="features">
                @foreach (var feature in Model.CurrentVehicle.VehicleDetails.Features.Split(';')) {
                    <span class="btn btn-outline-secondary shadow gap-2 my-1">@feature</span>
                }
            </div>
        </div>

        @*Loan app*@
        <div class="row justify-content-center well my-3">
            <button class="btn btn-light shadow w-100" type="button" data-bs-toggle="collapse" data-bs-target="#application" aria-expanded="false" aria-controls="featapplicationures">
                <div class="bg-lighter py-2 px-3 text-center hand-pointer">
                    <h5 class="fw-bold text-uppercase">Loan application</h5>
                </div>
            </button>
            <div class="collapse text-shadow-small rounded shadow mt-2" id="application">
                <div class="col-12">
                    <iframe src="https://www.700dealer.com/QuickQualify/43783416bf5141ff8b8d1a40387ee700-20181212" width="100%" height="400px" scrolling="auto"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

@*May Like*@
<div class="row p-3 mx-auto p-2 w-75">
    <button class="btn btn-light shadow" type="button" data-bs-toggle="collapse" data-bs-target="#suggestion" aria-expanded="false" aria-controls="features">
        <div class="bg-lighter py-2 px-3 text-center hand-pointer">
            <h5 class="fw-bold text-uppercase">You may also like</h5>
        </div>
    </button>
    <div class="collapse" id="suggestion">    
        <div class="d-flex justify-content-evenly">
            <span type="button" class="btn btn-secondary scroll-button" onclick="scrollSuggestions(-300)">
                <i class="bi bi-arrow-left-circle-fill"></i>
            </span>
            <div class="scroll-container well shadow" id="suggestionScroll">
                <div class="d-flex justify-content-evenly">
                    @foreach (var suggestion in Model.CurrentVehicle.VehicleSuggesion) {
                        <div class="card-wrapper">
                            @Html.Partial("_AdCard", suggestion)
                        </div>
                    }
                </div>
            </div>
            <span type="button" class="btn btn-secondary scroll-button" onclick="scrollSuggestions(300)">
                <i class="bi bi-arrow-right-circle-fill"></i>
            </span>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function (e) {
        calculate();

        lc_lightbox(".elem", {
            wrap_class: "lcl_fade_oc",
            gallery: true,
            thumb_attr: "data-lcl-thumb",
            skin: "light",
            radius: 4,
            padding: 0,
            border_w: 1
        });

        $.get(`${root}Home/ContactForm`, { "id": 0 })
            .done(function (result) {
                $("#contactTab").html(result);
                // $("#unlock").html(result);
            })
            .fail(function () {
            })
            .always(function () {
            })

        $("input[name='scores']").change(function () {
            calculate();
        });

        $(".hover-bw").on("click", function () {
            const stock = $(this).data("stock");
            if (stock) {
                window.location.href = `${root}Inventory/Details?stock=${stock}`
            }
        });
    });

    function calculate() {
        const score = $("input[name='scores']:checked").val();
        const amount = @Model.CurrentVehicle.VehicleDetails.RetailPrice - $("#downPayment").val();
        const term = $("#month").val();
        $("#monthTerms").html(term);
        const rate = getInterestRate(score);
        $("#apr").html(rate);
        const monthly = calculateMonthlyPayment(amount, rate, term);
        $("#monthlyAmount").html(monthly.toFixed(2));
    }

    function scrollSuggestions(amount) {
        const container = document.getElementById('suggestionScroll');
        container.scrollBy({ left: amount, behavior: 'smooth' });
    }

</script>




