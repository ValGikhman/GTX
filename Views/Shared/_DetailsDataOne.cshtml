@model GTX.Models.BaseModel
@using System.Linq
@using System.Globalization

@functions{
    string Safe(string s) => string.IsNullOrWhiteSpace(s) ? "" : s;
    string Id(params object[] parts) => string.Join("_", parts.Where(p => p != null));
    string Money(string val, string culture = "en-US", string format = "C2") {
        if (string.IsNullOrWhiteSpace(val)) return "";
        if (decimal.TryParse(val, NumberStyles.Any, CultureInfo.InvariantCulture, out var d))
            return d.ToString(format, CultureInfo.GetCultureInfo(culture));
        return "";
    }
    string Specs(List<GTX.Models.SpecificationCategory> categories, string category, string value) {
        return categories?
            .FirstOrDefault(c => c.Name == category)?
            .Values?
            .FirstOrDefault(v => v.Name == value)?
            .Value ?? string.Empty;
    }
    string Stands(List<GTX.Models.GenericEquipmentCategoryGroup> groups, string group, string category, string equipment) {
        var gr = groups.FirstOrDefault(g => g.Name == group);
        var cat = gr.Categories.FirstOrDefault(c => c.Name == category);
        var eqv = cat?.Equipments.FirstOrDefault(e => e.Name == equipment);
        var values = string.Join(", ", eqv.Values.Select(m => ToCamelCase(m.Value)));
        return values;
    }
    string ToCamelCase(string input) {
        if (string.IsNullOrEmpty(input)) return input;
        var words = input.Split(new[] { ", " }, StringSplitOptions.RemoveEmptyEntries)
                         .Select(w => char.ToUpperInvariant(w[0]) + w.Substring(1).ToLower());
        return string.Concat(words);
    }
}

<style>
    .toggle {
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: .5rem;
    }

    .pm {
        display: inline-block;
        width: 1.5rem;
        text-align: center;
        line-height: 1.5rem;
    }

        .pm::before {
            content: "+";
        }

    .toggle[aria-expanded="true"] .pm::before {
        content: "–";
    }


    .kv td:first-child {
        white-space: nowrap;
        color: var(--bs-secondary-color);
        width: 1%;
    }

    .muted {
        color: var(--bs-secondary-color);
    }

    .section {
        margin-bottom: .75rem;
    }

    .w-20 {
        width: 20% !important;
    }
</style>

<div class="row justify-content-center well mb-3">
    <button class="w-100 btn btn-gradient position-relative collapse-toggle"
            data-bs-toggle="collapse"
            data-bs-target="#details"
            aria-expanded="true"
            aria-controls="details">
        <div class="bg-lighter py-2 px-3 text-center hand-pointer">
            @if (ViewBag.IsMajordome) {
                <h5 class="fw-bold text-uppercase text-white" onclick="window.open('/Majordome/Inventory/@(Uri.EscapeDataString(Model.CurrentVehicle.VehicleDetails.Stock))', '_blank')">
                    <i class="bi bi-car-front mx-2"></i>Details
                </h5>
            }
            else {
                <h5 class="fw-bold text-uppercase text-white">
                    <i class="bi bi-car-front mx-2"></i>Details
                </h5>
            }
        </div>
        <span class="toggle-icons position-absolute end-0 top-50 translate-middle-y pe-3" aria-hidden="true">
            <i class="bi bi-plus-lg icon-plus"></i>
            <i class="bi bi-dash-lg icon-minus"></i>
        </span>
    </button>

    <div class="text-shadow-small show" id="details">
        <div class="mt-2  px-5 ">
            @if (Model.CurrentVehicle.VehicleDataOneDetails?.QueryResponses?.Items == null || !Model.CurrentVehicle.VehicleDataOneDetails.QueryResponses.Items.Any()) {
                <div class="alert alert-warning">No query responses.</div>
            }
            else {
                var qi = 0;
                foreach (var qr in Model.CurrentVehicle.VehicleDataOneDetails.QueryResponses.Items) {
                    var qrId = Id("qr", qi++);

                    if (!string.IsNullOrWhiteSpace(qr?.QueryError?.ErrorCode)) {<span class="badge bg-danger">Error @qr.QueryError.ErrorCode</span>}

                if (qr?.UsMarketData?.UsStyles?.Styles == null || !qr.UsMarketData.UsStyles.Styles.Any()) {
                    <div class="muted">No US market styles.</div>
                }
                else {
                    var si = 0;
                    foreach (var style in qr.UsMarketData.UsStyles.Styles) {
                        var sId = Id(qrId, "s", si++);
                        var bdId = Id("bd", sId);
                        var prId = Id("pr", sId);
                        var enId = Id("en", sId);
                        var trId = Id("tr", sId);
                        var ssId = Id("ss", sId);
                        var geStdId = Id("geStd", sId);
                        var geOptId = Id("geOpt", sId);
                        var colId = Id("col", sId);
                        var wId = Id("wr", sId);
                        var epaId = Id("epa", sId);
                        var greenId = Id("green", sId);
                        var nhtsaId = Id("nhtsa", sId);

                        <!-- Basic -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                               data-bs-toggle="collapse"
                               data-bs-target="#@bdId"
                               aria-expanded="true"
                               aria-controls="@bdId">

                                <span class="d-flex justify-content-center text-shadow">
                                    <strong>@Safe(style.BasicData.Year) @Safe(style.BasicData.Make) @Safe(style.Name) - @Model.CurrentVehicle.VehicleDetails.RetailPrice.ToString("C0")</strong>
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>

                            <div id="@bdId" class="collapse show">
                                @if (style?.BasicData == null) {<div class="muted">No data</div> }
                                else {
                                    <table class="table table-sm kv mt-3">
                                        <tbody>
                                            <tr>
                                                <td class="fw-bold w-25">Miles: </td>
                                                <td colspan="3" class="w-25">@Model.CurrentVehicle.VehicleDetails.Mileage.ToString("N0")</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold w-25">VIN#: </td>
                                                <td class="w-25 copyable">@Model.CurrentVehicle.VehicleDetails.VIN</td>
                                                <td class="fw-bold w-25">Stock#</td>
                                                <td class="w-25 copyable">@Model.CurrentVehicle.VehicleDetails.Stock</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Vehicle Type</td>
                                                <td>@Safe(style.BasicData.VehicleType)</td>
                                                <td class="fw-bold">Body Type</td>
                                                <td>@Safe(style.BasicData.BodyType)</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Doors</td>
                                                <td>@Safe(style.BasicData.Doors)</td>
                                                <td class="fw-bold">Drive Type</td>
                                                <td>@Safe(style.BasicData.DriveType)</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Brake System</td>
                                                <td>@Safe(style.BasicData.BrakeSystem)</td>
                                                <td class="fw-bold">Restraint Type</td>
                                                <td>@Safe(style.BasicData.RestraintType)</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Seats</td>
                                                <td>@Specs(style.StandardSpecifications.Categories, "Seating", "Max Seating")</td>
                                                <td class="fw-bold">Rows</td>
                                                <td>@Specs(style.StandardSpecifications.Categories, "Seating", "Seating Rows")</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Fuel tank capacity</td>
                                                <td>@Specs(style.StandardSpecifications.Categories, "Weights and Capacities", "Fuel Tank Capacity") gal</td>
                                                <td class="fw-bold">Front airbags</td>
                                                <td>@Stands(style.StandardGenericEquipment.Groups, "Safety and Security", "Airbags", "Front airbags")</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">External color (@Model.CurrentVehicle.VehicleDetails.Color)</td>
                                                <td><span style="width:36px;height:36px;border-radius:4px;border:1px solid #ccc; display:inline-block; background-color:@Model.CurrentVehicle.VehicleDetails.Color"></span></td>
                                                @if (!string.IsNullOrWhiteSpace(Model.CurrentVehicle.VehicleDetails.Color2)) {
                                                    <td class="fw-bold">Internal color (@Model.CurrentVehicle.VehicleDetails.Color2)</td>
                                                    <td><span style="width:36px;height:36px;border-radius:4px;border:1px solid #ccc; display:inline-block; background-color:@Model.CurrentVehicle.VehicleDetails.Color2"></span></td>
                                                }
                                                else {
                                                    <td colspan="2"></td>
                                                }
                                            </tr>
                                        </tbody>
                                    </table>
                                }
                            </div>
                        </div>

                        <!-- EPA MPG -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@epaId"
                                    aria-expanded="true"
                                    aria-controls="@epaId">

                                <span class="d-flex justify-content-center text-shadow">
                                    <strong>Fuel Efficiency</strong>
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>

                            <div id="@epaId" class="collapse show mt-2">
                                @if (style?.EpaFuelEfficiency?.Records == null || !style.EpaFuelEfficiency.Records.Any()) {<div class="muted">No records</div> }
                                else {
                                    <table class="table align-middle mb-0">
                                        <thead><tr><th>Engine</th><th>Trans</th><th>Fuel</th><th>Grade</th><th>City</th><th>Hwy</th><th>Comb</th></tr></thead>
                                        <tbody>
                                            @foreach (var r in style.EpaFuelEfficiency.Records) {
                                                <tr><td class="text-muted">@Safe(r?.EngineId)</td><td class="text-muted">@Safe(r?.TransmissionId)</td><td>@Safe(r?.FuelType)</td><td>@Safe(r?.FuelGrade)</td><td>@Safe(r?.City)</td><td>@Safe(r?.Highway)</td><td>@Safe(r?.Combined)</td></tr>
                                            }
                                        </tbody>
                                    </table>
                                }
                            </div>
                        </div>

                        <!-- Engines -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@enId"
                                    aria-expanded="true"
                                    aria-controls="@enId">

                                <span class="d-flex justify-content-center text-shadow">
                                    <strong>Engine @((!string.IsNullOrWhiteSpace(style.Engines.Items[0]?.Name) ? style.Engines.Items[0]?.Name : $"{Model.CurrentVehicle.VehicleDetails.Engine}"))</strong>
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>

                            <div id="@enId" class="collapse show mt-2">
                                @if (style?.Engines?.Items == null || !style.Engines.Items.Any()) {<div class="muted">No engines</div> }
                                else {
                                    var ei = 0;
                                    foreach (var e in style.Engines.Items) {
                                        <div class="border rounded p-2 mb-2">
                                            <table class="table table-sm kv mb-0 mt-1">
                                                <tbody>
                                                    <!-- Elements -->
                                                    <tr>
                                                        <td class="fw-bold w-25">Aspiration</td>
                                                        <td class="w-25">@Safe(e.IceAspiration)</td>
                                                        <td class="fw-bold w-25">Block Type</td>
                                                        <td class="w-25">@Safe(e.IceBlockType)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Cam Type</td>
                                                        <td>@Safe(e.IceCamType)</td>
                                                        <td class="fw-bold">Fuel Type</td>
                                                        <td>@Safe(e.FuelType)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Compression</td>
                                                        <td>@Safe(e.IceCompression)</td>
                                                        <td class="fw-bold">Cylinders</td>
                                                        <td>@Safe(e.IceCylinders)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Displacement</td>
                                                        <td>@Safe(e.IceDisplacement)</td>
                                                        <td class="fw-bold">Type</td>
                                                        <td>@Safe(e.EngineType)</td>
                                                    </tr>
                                                    @if (e.ElectricMaxHp != "0") {
                                                        <tr>
                                                            <td class="fw-bold">Electric Max HP</td>
                                                            <td>@Safe(e.ElectricMaxHp)</td>
                                                            <td class="fw-bold">Electric Max kW</td>
                                                            <td>@Safe(e.ElectricMaxKw)</td>
                                                        </tr>
                                                        <tr>
                                                            <td class="fw-bold">Electric Motor Configuration</td>
                                                            <td>@Safe(e.ElectricMotorConfiguration)</td>
                                                            <td class="fw-bold">Electric Max Torque</td>
                                                            <td>@Safe(e.ElectricMaxTorque)</td>
                                                        </tr>
                                                        <tr>
                                                            <td class="fw-bold">Generator Description</td>
                                                            <td>@Safe(e.GeneratorDescription)</td>
                                                            <td class="fw-bold">Generator Max HP</td>
                                                            <td>@Safe(e.GeneratorMaxHp)</td>
                                                        </tr>
                                                    }
                                                    <tr>
                                                        <td class="fw-bold">Fuel Induction</td>
                                                        <td>@Safe(e.IceFuelInduction)</td>
                                                        <td class="fw-bold">Fuel Quality</td>
                                                        <td>@Safe(e.FuelQuality)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Max HP</td>
                                                        <td>@Safe(e.IceMaxHp)</td>
                                                        <td class="fw-bold">Max HP @@</td>
                                                        <td>@Safe(e.IceMaxHpAt)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Max Torque</td>
                                                        <td>@Safe(e.IceMaxTorque)</td>
                                                        <td class="fw-bold">Max Torque @@</td>
                                                        <td>@Safe(e.IceMaxTorqueAt)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Oil Capacity</td>
                                                        <td>@Safe(e.OilCapacity)</td>
                                                        <td class="fw-bold">Stroke</td>
                                                        <td>@Safe(e.IceStroke)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Total Max HP</td>
                                                        <td>@Safe(e.TotalMaxHp)</td>
                                                        <td class="fw-bold">Total Max HP @@</td>
                                                        <td>@Safe(e.TotalMaxHpAt)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Total Max Torque</td>
                                                        <td>@Safe(e.TotalMaxTorque)</td>
                                                        <td class="fw-bold">Total Max Torque @@</td>
                                                        <td>@Safe(e.TotalMaxTorqueAt)</td>

                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Valve Timing</td>
                                                        <td>@Safe(e.IceValveTiming)</td>
                                                        <td class="fw-bold">Valves</td>
                                                        <td>@Safe(e.IceValves)</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        ei++;
                                    }
                                }
                            </div>
                        </div>

                        <!-- Transmissions -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@trId"
                                    aria-expanded="true"
                                    aria-controls="@trId">

                                <span class="d-flex justify-content-center text-shadow">
                                    <strong>Transmission @((!string.IsNullOrWhiteSpace(style.Transmissions.Items[0]?.Name) ? style.Transmissions.Items[0]?.Name : $"{Model.CurrentVehicle.VehicleDetails.Transmission}"))</strong>
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>

                            <div id="@trId" class="collapse mt-2 show">
                                @if (style?.Transmissions?.Items == null || !style.Transmissions.Items.Any()) {<div class="muted">No transmissions</div> }
                                else {
                                    var ti = 0;
                                    foreach (var t in style.Transmissions.Items) {
                                        <div class="border rounded p-2 mb-2">
                                            <table class="table table-sm kv mb-0 mt-1">
                                                <tbody>
                                                    <!-- Elements -->
                                                    <tr>
                                                        <td class="fw-bold w-25">Type</td>
                                                        <td class=" w-25">@Safe(t.Type)</td>
                                                        <td class="fw-bold w-25">Detail Type</td>
                                                        <td class=" w-25">@Safe(t.DetailType)</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-bold">Gears</td>
                                                        <td>@Safe(t.Gears)</td>
                                                        <td class="fw-bold">Order Code</td>
                                                        <td>@Safe(t.OrderCode)</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        ti++;
                                    }
                                }
                            </div>
                        </div>

                        <!-- Standard Specifications -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@ssId"
                                    aria-expanded="false"
                                    aria-controls="@ssId">

                                <span class="d-flex justify-content-center text-shadow">
                                    Standard Specifications
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>
                            <div id="@ssId" class="collapse mt-2">
                                @if (style?.StandardSpecifications?.Categories == null || !style.StandardSpecifications.Categories.Any()) {<div class="muted">No specifications</div> }
                                else {
                                    var ci = 0;
                                    foreach (var cat in style.StandardSpecifications.Categories) {
                                        var catId = Id("spec", sId, ci++);
                                        <div class="mb-1">
                                            <a class="toggle" data-bs-toggle="collapse" href="#@catId" aria-expanded="false">
                                                <span class="pm"></span> @(!string.IsNullOrWhiteSpace(cat?.Name) ? cat.Name : "Category")
                                            </a>
                                            <div id="@catId" class="collapse mt-2 ms-3">
                                                @if (cat?.Values == null || !cat.Values.Any()) {<div class="muted">No values</div> }
                                                else {
                                                    <table class="table align-middle mb-0">
                                                        <thead><tr><th style="width:35%">Name</th><th>Value</th></tr></thead>
                                                        <tbody>
                                                            @foreach (var v in cat.Values) {
                                                                <tr><td class="fw-bold">@Safe(v?.Name)</td><td><code>@Safe(v?.Value)</code></td></tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                }
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>

                        <!-- Equipment (Standard) -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@geStdId"
                                    aria-expanded="false"
                                    aria-controls="@geStdId">

                                <span class="d-flex justify-content-center text-shadow">
                                    Standard Equipment
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>
                            <div id="@geStdId" class="collapse mt-2">
                                @Html.Partial("_GenericEquipmentTree", style?.StandardGenericEquipment)
                            </div>
                        </div>

                        <!-- Equipment (Optional) -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@geOptId"
                                    aria-expanded="false"
                                    aria-controls="@geOptId">

                                <span class="d-flex justify-content-center text-shadow">
                                    Optional Equipment
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>
                            <div id="@geOptId" class="collapse mt-2">
                                @Html.Partial("_GenericEquipmentTree", style?.OptionalGenericEquipment)
                            </div>
                        </div>

                        <!-- Colors -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@colId"
                                    aria-expanded="false"
                                    aria-controls="@colId">

                                <span class="d-flex justify-content-center text-shadow">
                                    Colors
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>

                            <div id="@colId" class="collapse mt-2">
                                @if (style?.Colors == null) {<div class="muted">No colors</div> }
                                else {
                                    <div class="row g-2">
                                        <div class="col-12 col-md-6">
                                            <div class="fw-semibold mb-1">Exterior</div>
                                            @if (style.Colors.Exterior?.Colors == null || !style.Colors.Exterior.Colors.Any()) {<div class="muted">None</div> }
                                            else {
                                                <ul class="list-group list-group-flush">
                                                    @foreach (var c in style.Colors.Exterior.Colors) {
                                                        var hex = Safe(c?.PrimaryRgbCode?.Hex);
                                                        <li class="list-group-item d-flex align-items-center py-2">
                                                            <span class="me-2" style="width:36px;height:36px;border-radius:4px;border:1px solid #ccc; display:inline-block; background-color:@(string.IsNullOrWhiteSpace(hex) ? "#ddd" : "#"+hex)"></span>
                                                            <div>
                                                                <div class="fw-semibold">@Safe(c?.MfrColorName)</div>
                                                                <div class="muted">@Safe(c?.GenericColorName) @if (!string.IsNullOrWhiteSpace(hex)) {<text>(#@hex)</text>}</div>
                                                            </div>
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="fw-semibold mb-1">Interior</div>
                                            @if (style.Colors.Interior?.Colors == null || !style.Colors.Interior.Colors.Any()) {<div class="muted">None</div> }
                                            else {
                                                <ul class="list-group list-group-flush">
                                                    @foreach (var c in style.Colors.Interior.Colors) {
                                                        var hex = Safe(c?.PrimaryRgbCode?.Hex);
                                                        <li class="list-group-item d-flex align-items-center py-2">
                                                            <span class="me-2" style="width:36px;height:36px;border-radius:4px;border:1px solid #ccc; display:inline-block; background-color:@(string.IsNullOrWhiteSpace(hex) ? "#ddd" : "#"+hex)"></span>
                                                            <div>
                                                                <div class="fw-semibold">@Safe(c?.MfrColorName)</div>
                                                                <div class="muted">@Safe(c?.GenericColorName) @if (!string.IsNullOrWhiteSpace(hex)) {<text>(#@hex)</text>}</div>
                                                            </div>
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- Pricing -->
                        <div class="section">
                            <button class="w-100 btn btn-gradient-grey border-black shadow rounded-4 position-relative collapse-toggle"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#@prId"
                                    aria-expanded="false"
                                    aria-controls="@prId">

                                <span class="d-flex justify-content-center text-shadow">
                                    Pricing
                                </span>

                                <span class="toggle-icons position-absolute mx-3 start-0 top-50 translate-middle-y pe-3" aria-hidden="true">
                                    <i class="bi bi-plus-lg icon-plus"></i>
                                    <i class="bi bi-dash-lg icon-minus"></i>
                                </span>
                            </button>
                            <div id="@prId" class="collapse mt-2">
                                @if (style?.Pricing == null) {<div class="muted">No data</div> }
                                else {
                                    <table class="table table-sm kv mb-0">
                                        <tbody>
                                            <tr><td class="fw-bold w-50">MSRP</td><td>@Safe(Money(style.Pricing.Msrp))</td></tr>
                                            <tr><td class="fw-bold">Invoice</td><td>@Safe(Money(style.Pricing.InvoicePrice))</td></tr>
                                            <tr><td class="fw-bold">Destination</td><td>@Safe(style.Pricing.DestinationCharge)</td></tr>
                                            <tr><td class="fw-bold">Gas Guzzler</td><td>@Safe(style.Pricing.GasGuzzlerTax)</td></tr>
                                        </tbody>
                                    </table>
                                }
                            </div>
                        </div>

                        @* Only the first style *@
                        break;
                    }
                }
            }
        }
        </div>
    </div>
</div>