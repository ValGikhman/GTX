@model GTX.Models.GTX
@{
    var detailsUrl = Url.Action("Details", "Inventory", new { stock = Model.Stock });
    var makeImg = $"/GTXImages/makes/{Model.Make.Replace(" ", "-")}.png";
    var carTitle = $"{Model.Year} {Model.Make} {Model.Model}";
}

<style>
    /* ========= GTX Card Pro (scoped to this partial) ========= */
    /* CRITICAL: allow flex child to shrink (otherwise nowrap still wraps in weird ways) */
    .gtx-title-wrap,
    .gtx-title-stack {
        min-width: 0;
    }

    /* force model/style to stay one line and ellipsize */
    .gtx-trimline {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }

    /* optional: ensure the make line also behaves well */
    .gtx-truncate-1 {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .gtx-card {
        border: 0 !important;
        border-radius: 1rem !important;
        overflow: hidden;
        box-shadow: 0 10px 24px rgba(0,0,0,.12);
        transition: transform .14s ease, box-shadow .14s ease;
        background: #fff;
    }

        .gtx-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 38px rgba(0,0,0,.20);
        }

    .gtx-header {
        border: 0 !important;
        position: relative;
        padding: .65rem .75rem;
    }

    .gtx-title {
        font-weight: 600;
        line-height: 1.05;
    }

    .gtx-subtitle {
        font-weight: 700;
        opacity: .92;
        line-height: 1.1;
    }

    .gtx-truncate-1 {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .gtx-truncate-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .gtx-chip {
        display: inline-flex;
        align-items: center;
        gap: .35rem;
        padding: .2rem .5rem;
        border-radius: 999px;
        border: 1px solid rgba(0,0,0,.18);
        background: rgba(255,255,255,.75);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        font-size: .72rem;
        font-weight: 800;
        color: #222;
        user-select: none;
    }

    .gtx-chip-dark {
        border: 1px solid rgba(255,255,255,.22);
        background: rgba(0,0,0,.35);
        color: #fff;
    }

    .gtx-open {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgba(0,0,0,.18);
        background: rgba(255,255,255,.70);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        transition: transform .12s ease, opacity .12s ease;
        opacity: .92;
    }

        .gtx-open:hover {
            transform: scale(1.06);
            opacity: 1;
        }

    /* Image area */
    .gtx-media {
        position: relative;
    }

        .gtx-media .ratio {
            background: rgba(0,0,0,.05);
        }

    .gtx-img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* SRP should look premium */
        object-position: center;
        display: block;
        transform: scale(1.001); /* prevents hairline gaps on some GPUs */
    }

    /* Image top-left badge row */
    .gtx-badges {
        position: absolute;
        left: .55rem;
        top: .55rem;
        display: flex;
        gap: .35rem;
        z-index: 3;
        pointer-events: none; /* keeps whole card clickable */
    }

    /* Footer */
    .gtx-footer {
        border: 0 !important;
        padding: .6rem .75rem .7rem;
    }

    .gtx-price {
        font-weight: 900;
        letter-spacing: .2px;
        font-size: 1.05rem;
    }

    .gtx-meta {
        font-weight: 800;
        opacity: .95;
        font-size: .85rem;
    }

    .gtx-kv {
        display: flex;
        justify-content: space-between;
        gap: .75rem;
        align-items: baseline;
        flex-wrap: wrap;
    }

    .gtx-divider {
        height: 1px;
        background: rgba(0,0,0,.12);
        margin: .45rem 0 .4rem;
    }

    /* Dark-theme friendliness if you later theme surfaces */
    html.theme-grey .gtx-chip,
    html.theme-pink .gtx-chip,
    html.theme-purple .gtx-chip,
    html.theme-metallica .gtx-chip {
        border-color: rgba(255,255,255,.22);
        background: rgba(0,0,0,.30);
        color: #fff;
    }

        /* Premium ring around the LI (works great with rounded-4) */
    .gtx-card-premium{
        position: relative;
        border: 0 !important;                 /* let the ring do the work */
        border-radius: 1.25rem;               /* match rounded-4 */
        overflow: visible;                    /* so glow can show */
        box-shadow: 0 12px 26px rgba(0,0,0,.18);
        transform: translateZ(0);
    }

    /* Outer gradient ring */
    .gtx-card-premium::before{
        content:"";
        position:absolute;
        inset:-1px;                           /* ring thickness */
        border-radius: inherit;
        background: linear-gradient(135deg,
        rgba(255,255,255,.45),
        rgba(255,255,255,.10),
        rgba(0,0,0,.25)
        );
        z-index: 0;
        pointer-events: none;
    }

    /* Inner surface border (crisp edge) */
    .gtx-card-premium::after{
        content:"";
        position:absolute;
        inset:1px;                            /* keeps ring visible */
        border-radius: calc(1.25rem - 2px);
        background: rgba(255,255,255,.03);    /* subtle inner film */
        box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
        z-index: 0;
        pointer-events: none;
    }

    /* Lift + glow on hover */
    .gtx-card-premium:hover{
        transform: translateY(-2px);
        box-shadow: 0 18px 40px rgba(0,0,0,.28);
    }

    /* Make your real content sit above the ring */
    .gtx-card-premium > .h-100{
        position: relative;
        z-index: 1;
        border-radius: inherit;
        overflow: hidden;                     /* keep image corners clean */
    }
</style>

<li id="@Model.Stock"
    class="card gtx-card gtx-card-premium col-12 col-sm-6 col-md-4 col-lg-3 hand-pointer"
    title="Click here to see details."
    data-url="@detailsUrl"
    data-location-code="@Model.LocationCode"
    data-story="@(Model.Story is not null && !Model.Story.HtmlContent.ToUpper().Contains("ERROR") ? "STORY" : "NOSTORY")"
    data-dataone="@(Model.DataOne is not null ? "DATAONE" : "NODATAONE")"
    data-images="@(Model.Image is not null && Model.Image.Contains("no-image") ? "NOIMAGE" : "IMAGE")"
    data-year="@Model.Year"
    data-stock="@Model.Stock.ToUpper()"
    data-vin="@Model.VIN.ToUpper()"
    data-make="@Model.Make.ToUpper()"
    data-model="@Model.Model.ToUpper()"
    data-transmission="@Model.TransmissionWord.ToUpper()"
    data-style="@Model.VehicleStyle.ToUpper()"
    data-type="@Model.VehicleType.ToUpper()"
    data-miles="@Model.Mileage"
    data-price="@Model.InternetPrice"
    data-cylinders="@Model.Cylinders"
    data-color="@Model.Color.ToUpper()"
    data-color2="@Model.Color2.ToUpper()">

    <!-- Keep structure clickable (your JS likely binds on li/card click) -->
    <div class="h-100 rounded-4 overflow-hidden">

        <!-- HEADER (keeps your gradient look) -->
        <div class="card-header gradient gtx-header p-1">
            <div class="d-flex align-items-center gap-2">

                <!-- Make logo -->
                <div class="flex-shrink-0 d-flex align-items-center">
                    <img src="@makeImg" alt="@Model.Make logo" data-make="@Model.Make" class="img-fluid" style="height:38px;" loading="lazy" decoding="async" />
                </div>

                <!-- Title stack -->
                <div class="flex-grow-1 min-h-0 gtx-title-wrap">
                    <div class="d-flex justify-content-between align-items-start gap-2">

                        <div class="min-h-0 gtx-title-stack">
                            <!-- Make line -->
                            <div class="gtx-title fs-5 text-shadow gtx-truncate-1 mb-0" style="line-height:1.05;">
                                @Model.Year @Model.Make
                            </div>

                            <!-- Model/style line (NO WRAP + ellipsis) -->
                            <div class="fs-6 text-shadow gtx-trimline mt-0" style="line-height:1.05;">
                                @Model.Model - @Model.VehicleStyle
                            </div>
                        </div>

                        <!-- open-in-new-tab (keeps stopPropagation) -->
                        <a href="@detailsUrl" target="_blank" rel="noopener" class="gtx-open text-dark shadow flex-shrink-0" title="Open details in new tab" onclick="event.stopPropagation();">
                            <i class="bi bi-box-arrow-up-right"></i>
                        </a>

                    </div>
                </div>
            </div>
        </div>


        <!-- IMAGE -->
        <div class="card-body p-0  ez360-srp-pic gtx-media" data-vin="@Model.VIN">
            <!-- badges use your data flags; optional but helpful visually -->
            <div class="gtx-badges" style="top: 2px">
                <!-- Like badge (hidden by default) -->
                <span class="gtx-chip gtx-chip-dark liked shadow" style="display:none;" title="Liked">
                    <i class="bi bi-heart-fill text-danger"></i>
                    <span>Liked</span>
                </span>

                @if (Model.Story is not null && !(Model.Story.HtmlContent ?? "").ToUpper().Contains("ERROR"))
                {
                    <span class="gtx-chip gtx-chip-dark shadow"><i class="bi bi-feather"></i> Story</span>
                }
                @if (Model.DataOne is not null)
                {
                    <span class="gtx-chip gtx-chip-dark shadow"><i class="bi bi-shield-check"></i> DataOne</span>
                }
            </div>

            <img class="gtx-img" src="@Model.Image" alt="@carTitle" loading="lazy" decoding="async" />
        </div>

        <!-- FOOTER (3 rows, keeps gradient) -->
        <div class="card-footer gradient no-click py-1 fs-6 fw-bold text-shadow" ">
            <!-- Row 1: Price + Miles (like before) -->
            <div class="d-flex justify-content-between align-items-baseline">
                <span>
                    <i class="bi bi-car-front"></i>
                    @I18n.R("All_Price"): @Model.InternetPrice.ToString("C0", new System.Globalization.CultureInfo("en-US"))
                </span>
                <span>
                    <i class="bi bi-speedometer2 me-1"></i>@Model.Mileage.ToString("N0") @I18n.R("All_Miles")
                </span>
            </div>

            <!-- Row 2: VIN + Stock -->
            <div class="d-flex justify-content-between align-items-center" style="margin-top: -5px;">
                <span class="copyable very-small-text hand-pointer text-truncate V @Model.LocationCode" style="max-width: 70%;" title="Copy VIN">
                    @Model.VIN
                </span>
                <span class="copyable very-small-text hand-pointer text-truncate V @Model.LocationCode" style="max-width: 70%;" title="Copy Stock#">
                    @Model.Stock
                </span>
            </div>
            <!-- Row 3 : Carfax (centered) -->
            <div class="d-flex justify-content-center align-items-center mb-2">
                <a class="d-inline-flex align-items-center" href="http://www.carfax.com/VehicleHistory/p/Report.cfx?partner=DVW_1&vin=@Model.VIN" target="_blank" rel="noopener" onclick="event.stopPropagation();" title="Open Carfax">
                    <img src="https://static.carfax.com/global-header/imgs/logo.svg" alt="Carfax Vehicle History Report" style="height:18px; width:auto;">
                </a>
            </div>
        </div>
    </div>
</li>
