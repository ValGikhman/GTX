@model GTX.Models.GenericEquipmentGroups
@using System.Linq

<style>
</style>

@functions{
    string Safe(string s) => string.IsNullOrWhiteSpace(s) ? "" : s;
    string Id(params object[] parts) => string.Join("_", parts.Where(p => p != null)) + "_" + Guid.NewGuid().ToString("N");
    string ToCamelCase(string input) {
        if (string.IsNullOrEmpty(input)) return input;
        var words = input.Split(new[] { ", " }, StringSplitOptions.RemoveEmptyEntries)
                         .Select(w => char.ToUpperInvariant(w[0]) + w.Substring(1).ToLower());
        return string.Concat(words);
    }
}

@{
    // Define the pairs you want to skip
    var skipPairs = new List<(string GName, string CName)>
    {
        ("Exterior", "Exterior Features"),
        ("Exterior", "Wheels and Tires"),
        ("Interior", "Air Conditioning"),
        ("Interior", "Comfort Features"),
        ("Interior", "Instrumentation"),
        ("Interior", "Convenience Features"),
        ("Safety and Security", "Stability and Traction")
    };
}

@if (Model?.Groups == null || !Model.Groups.Any()) {
    <div class="muted">None</div>
}
else {
    var gi = 0;
    foreach (var g in Model.Groups) {
        var gId = Id("geg", gi++);
        <div class="mb-1">
            <a class="toggle" data-bs-toggle="collapse" href="#@gId" aria-expanded="false">
                <span class="pm"></span> @Safe(g?.Name)
            </a>
            <div id="@gId" class="collapse mt-2 ms-3">
                @if (g?.Categories == null || !g.Categories.Any()) {
                    <div class="text-center">
                        <code>No categories to show</code>
                    </div>
                }
                else {
                    var ci = 0;
                    foreach (var c in g.Categories) {
                        if (skipPairs.Contains((g.Name, c.Name))) {
                            continue;
                        }
                        var cId = Id("gec", gId, ci++);
                        <div class="mb-1">
                            <a class="toggle" data-bs-toggle="collapse" href="#@cId" aria-expanded="false">
                                <span class="pm"></span> @Safe(c?.Name)
                            </a>
                            <div id="@cId" class="collapse mt-2 ms-3">
                                @if (c?.Equipments == null || !c.Equipments.Any()) {
                                    <div class="text-center">
                                        <code>No equipment to show</code>
                                    </div>
                                }
                                else {
                                    foreach (var e in c.Equipments) {
                                        if (!e.Values.Any(m => m.Value != null)) {
                                            continue;
                                        }
                                        <div class="ms-3">
                                            <table class="table table-sm kv mb-0">
                                                <tr>
                                                    <td class="fw-bold w-40">
                                                        @Safe(e?.Name)
                                                    </td>
                                                    <td>
                                                        @string.Join(", ", e.Values.Select(m => ToCamelCase(m.Value)))
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    }
}